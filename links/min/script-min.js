$.getJSON("../res/settings.json",function(e){var t=1;for(var l in e.links){$(".links ."+l).prev().attr("data-class",l);for(var a in e.links[l])$(".links ."+l).append('<li><a target="_blank" href="'+e.links[l][a].url+'">'+e.links[l][a].title+"</a></li>"),$(".editable ."+l).append('<li><fieldset><table><tbody><tr><td><input type="text" class="title" name="title" placeholder="title" value="'+e.links[l][a].title+'" tabindex="'+(t+0)+'" /></td><td rowspan="2"><input type="checkbox" name="'+e.links[l][a].title+'" title="remove" class="remove" tabindex="99" /></td></tr><tr><td><input type="text" class="url" name="url" placeholder="url" value="'+e.links[l][a].url+'" tabindex="'+(t+1)+'" /></td></tr></tbody></table></fieldset></li><br />'),t+=2;$(".editable ."+l).append('<input type="button" name="add" class="add" value="+" />'),$(".editable ."+l).append('<input type="button" name="removeLast" class="removeLast" value="-" />')}t-=2,$('input[type="radio"], input[type="button"], input[type="submit"], button, .button, a, summary').click(function(){$(this).blur(),parent.focus()}),$('.delete[type="checkbox"]').change(function(){$(this).val($(this).prop("checked")?!0:!1)}),$("#edit").click(function(){$(".editable, .links, #save, #cancel").toggle(),$(this).toggle()}),$("#cancel").click(function(){$(".editable, .links, #save, #edit").toggle(),$(this).toggle()}),$("summary").dblclick(function(){var t=$(this).attr("data-class");if("reddit"===t)if(localStorage.getItem("over_18"))for(var l in e.links[t])window.open(e.links[t][l].url,e.links[t][l].title);else localStorage.setItem("over_18",!0),window.open("http://www.reddit.com/over18","reddit.com: over 18?")}),$(".add").click(function(){$(this).before('<li><fieldset class="new"><table><tbody><tr><td><input type="text" class="title" name="title" placeholder="title" value="" tabindex="'+(t+1)+'" /></td><td rowspan="2"><input type="checkbox" name="'+e.links[l][a].title+'" title="remove" class="remove" tabindex="99" /></td></tr><tr><td><input type="text" class="url" name="url" placeholder="url" value="" tabindex="'+(t+2)+'" /></td></tr></tbody></table></fieldset></li><br />'),t+=2}),$("#links a").click(function(){-1===$(this).attr("href").indexOf("imgur")&&!localStorage.getItem("over_18")&&$(this).closest(".reddit").length>0&&localStorage.setItem("over_18",!0)}),$(document).keydown(function(e){var t=e.target.tagName.toLowerCase();"input"!==t&&"textarea"!==t?27===e.which&&$(".editable, .links, #save, #edit, #cancel").toggle():27===e.which&&($("input").blur(),parent.focus())}),$("#editLinks").submit(function(){$(".editable, .links, #save, #edit, #cancel").toggle();var t={formData:{reddit:[],tumblr:[]}};for(var l in e.links)for(var a="",i="",n=!1,s=0;s<document.getElementsByClassName("editable")[0].getElementsByClassName(l)[0].getElementsByClassName("title").length;s++){a=document.getElementsByClassName("editable")[0].getElementsByClassName(l)[0].getElementsByClassName("title")[s].value.trim(),i=document.getElementsByClassName("editable")[0].getElementsByClassName(l)[0].getElementsByClassName("url")[s].value.trim(),n=JSON.parse(document.getElementsByClassName("editable")[0].getElementsByClassName(l)[0].getElementsByClassName("remove")[s].value.trim());var r=document.getElementsByClassName("editable")[0].getElementsByClassName(l)[0].getElementsByTagName("fieldset").className.indexOf("new");""!==a&&" "!==a&&a||(a=e.links[l][s].title),""!==i&&" "!==i&&i||(i=e.links[l][s].url),t.formData[l].push({title:a,url:i,remove:n})}return $.ajax({url:"update_links.php",type:"POST",data:t,success:function(){setTimeout(function(){window.location=document.URL},10)}}),!1})});