$.getJSON("./res/settings.json",function(e){var t={images:new Rand(e.files.images),all:new Rand(e.files.all),videos:new Rand(e.files.videos),webm:new Rand(e.files.webm)},o=function(e){var t={};return location.search.substr(1).split("&").forEach(function(e){t[e.split("=")[0].trim()]=e.split("=")[1]}),e?t[e]:1===Object.keys(t).length?t[e]:Object.keys(t).length>1?t:void 0},n={used:function(e,t){var o=JSON.parse(localStorage.getItem("used"));if(Array.isArray(t))for(var n in t)-1===o.indexOf(t[n])&&o[e].push(t[n]);else-1===o[e].indexOf(t)&&o[e].push(t);localStorage.setItem("used",JSON.stringify(o))},backIndex:function(e){if(!localStorage.getItem("backIndex")){var o={all:0,images:0,videos:0,webm:0};localStorage.setItem("backIndex",JSON.stringify(o))}var n=JSON.parse(localStorage.getItem("backIndex"));n[e]=t[e].backIndex,localStorage.setItem("backIndex",JSON.stringify(n))}},a=function(n,a){var i="";"safe"===o("content")&&(i="&content=safe"),a||($("#tabs input").prop("checked",!1),$('#tabs input[value="'+n+'"]').prop("checked",!0)),window.history.pushState("str","stache",window.location.protocol+"//"+window.location.host+window.location.pathname+"?tab="+n+i),t[n].used.length>0?t[n].backIndex===t[n].used.length?l(n,"last"):l(n,"set",JSON.parse(t[n].used[t[n].backIndex-1])):0===t[n].used.length&&l(n,"new"),n=o("tab");for(var s in e.files[n])$("#functions #files").append('<option data-index="'+s+'" value="'+e.files[n][s].url+'" />');document.title="stache – "+n},i={toggle:function(){var e=o("tab"),t="";"safe"!==o("content")&&(t="&content=safe"),window.history.pushState("str","stache",window.location.protocol+"//"+window.location.host+window.location.pathname+"?tab="+e+t),$("#toggleSafety").toggleClass("checked"),$("#content :not(span):not(b)").toggle(),$("#toggleLinks").parent().toggleClass("disabled"),$("#toggleLinks").hasClass("checked")&&($("#toggleLinks").parent().hasClass("disabled")?$("#links").hide():$("#links").show())},on:function(){var e=o("tab"),t="&content=safe";window.history.pushState("str","stache",window.location.protocol+"//"+window.location.host+window.location.pathname+"?tab="+e+t),$("#toggleSafety").addClass("checked"),$("#content :not(span):not(b)").hide(),$("#toggleLinks").parent().addClass("disabled")},off:function(){var e=o("tab");window.history.pushState("str","stache",window.location.protocol+"//"+window.location.host+window.location.pathname+"?tab="+e),$("#toggleSafety").removeClass("checked"),$("#content :not(span):not(b)").show(),$("#toggleLinks").parent().removeClass("disabled")}},s=function(n){var i="";if("safe"===o("content")&&(i="&content=safe"),location.search?"safe"===o("content")&&(o("tab")?window.history.pushState("str","stache",window.location.protocol+"//"+window.location.host+window.location.pathname+"?tab="+o("tab")+i):window.history.pushState("str","stache",window.location.protocol+"//"+window.location.host+window.location.pathname+"?tab=all"+i)):window.history.pushState("str","stache",document.URL+"?tab=all"+i),c=o("tab"),n){$("#notLoad").show(),$.getJSON("./res/settings.json",function(e){e.files.all.length!==JSON.parse(localStorage.getItem("totalFilesLen"))&&(localStorage.clear(),location.reload(!0))});var s=JSON.parse(localStorage.getItem("used")),r=JSON.parse(localStorage.getItem("backIndex"));for(var d in s)t[d].addUsed(s[d]),t[d].backIndex=r[d];a(c),l(c,"set",JSON.parse(t[c].used[t[c].backIndex-1])),localStorage.getItem("over_18")&&$("#over_18").attr("disabled","disabled")}else{var h={images:[],all:[],videos:[],webm:[]};localStorage.setItem("notFirst",!0),localStorage.setItem("used",JSON.stringify(h)),localStorage.setItem("totalFilesLen",e.files.all.length),a(c)}$('input[type="radio"], input[type="checkbox"], input[type="button"], input[type="submit"], button, .button, a').click(function(){$(this).blur()}),$(window).bind("storage",function(e){e.originalEvent.newValue===!0&&$("#over_18").attr("disabled","disabled")}),"safe"===o("content")&&($("#toggleSafety").addClass("checked"),$("#content :not(span):not(b)").hide()),$("#links").hide(),i="",$("#tabs label").each(function(){$(this).attr("title",e.files[$(this).prev().val()].length)});for(var f in e.files[c])$("#functions #files").append('<option data-index="'+f+'" value="'+e.files[c][f].url+'" />');$("#functions code").each(function(){$(this).css($(this).text().length>1?{"font-size":"8pt"}:{"font-weight":"lighter"})}),parent.focus()},l=function(a,s,l){"new"===s?r=t[a].new():"back"===s?r=t[a].back():"set"===s?r=e.files[a].length>l?l:t[a].new():"last"===s?r=t[a].used[t[a].used.length-1]:"first"===s&&(r=t[a].used[0]),("mp4"===e.files[a][r].ext||"webm"===e.files[a][r].ext)&&$("#content video").unbind(),"all"===o("tab")||"all"!==o("tab")&&t.all.addUsed(r),$("#content").html(e.fileType[e.files[a][r].ext][0]+""+e.files[a][r].url+e.fileType[e.files[a][r].ext][1]),$("#content").append("<br /><span><b>"+r+'</b><i> – </i><a target="_blank" href="'+window.location.protocol+"//"+window.location.host+window.location.pathname+"media/"+e.files[a][r].url+'">'+e.files[a][r].url+"</a></span>"),n.used(a,r),n.backIndex(a),("safe"===o("content")||"hide"===l)&&(i.on(),"video"===e.files[a][r].type&&$("#content video").attr("muted","muted"))},c=o("tab");s(JSON.parse(localStorage.getItem("notFirst"))),$("#tabs label").mouseenter(function(){$tab=$(this).prev();var e=$tab.val(),t="";$tab.click(function(n){return n.metaKey&&$(this).not(":checked")?("safe"===o("content")&&(t="&content=safe"),window.open(window.location.protocol+"//"+window.location.host+window.location.pathname+"?tab="+e+t),!1):(a(e,!0),!0)})}),$("#content video").on("loadedmetadata",function(){$(document).keydown(function(e){return 32===e.which?($("#content video")[0].paused?$("#content video")[0].play():$("#content video")[0].pause(),!1):void 0}),$("#content video").click(function(){$(this)[0].paused?$(this)[0].play():$(this)[0].pause()})}),$(document).keydown(function(e){var t=e.target.tagName.toLowerCase(),n=o("tab"),s=[];if($("#tabs input").each(function(){s.push($(this).val().trim())}),"input"!==t&&"textarea"!==t){if(e.altKey||e.ctrlKey)if(!e.ctrlKey&&!e.altKey||!e.shiftKey||67!==e.which&&82!==e.which){if((e.ctrlKey||e.altKey)&&68===e.which)$("#functions").toggleClass("active");else if(e.altKey&&e.shiftKey&&32===e.which)i.toggle();else if(e.ctrlKey&&e.altKey)39===e.which?s.indexOf(n)<s.length-1?a(s[s.indexOf(n)+1]):s.indexOf(n)===s.length-1&&a(s[0]):37===e.which&&(s.indexOf(n)>0?a(s[s.indexOf(n)-1]):0===s.indexOf(n)&&a(s[s.length-1]));else if((e.ctrlKey||e.altKey)&&"number"==typeof JSON.parse(String.fromCharCode(e.which))){var c=JSON.parse(String.fromCharCode(e.which));c<=s.length&&c>0&&a(s[c-1])}}else localStorage.clear(),location.reload(!0);else 39===e.which?l(n,"new"):37===e.which&&l(n,"back");"safe"!==o("content")&&(27===e.which?($("#links").hide(),$("#toggleLinks").removeClass("checked")):13===e.which&&($("#links").toggle(),$("#toggleLinks").toggleClass("checked")))}}),$("#updateJSON").click(function(){$.ajax({url:"um/index.php",type:"POST",data:{},success:function(){$.getJSON("./res/settings.json",function(e){e.files.all.length!==JSON.parse(localStorage.getItem("totalFilesLen"))&&(localStorage.clear(),location.reload(!0))})}})}),$("#over_18").click(function(){localStorage.getItem("over_18")||(window.open("http://www.reddit.com/over18","reddit.com: over 18?"),localStorage.setItem("over_18",!0),$(this).attr("disabled","disabled"))}),$("#toggleSafety").click(function(){i.toggle()}),$("#toggleLinks").change(function(){return $(this).parent().hasClass("disabled")?($("#links").hide(),!1):($(this).toggleClass("checked"),void($(this).hasClass("checked")?$("#links").show():$("#links").hide()))}),$("#search").submit(function(){return!1}),$("#clearData").click(function(){localStorage.clear(),location.reload(!0)})});